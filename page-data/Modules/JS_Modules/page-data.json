{"componentChunkName":"component---src-templates-post-template-tsx","path":"/Modules/JS_Modules/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2>CommonJS, ESM 차이</h2>\n<p>함수들끼리 데이터를 공유하고 싶다면 전역 스코프에 해당 데이터를 둔다면 다른 내부 요소에 의해 망가질 수도 있고, 순서가 뒤엉켜 전역 스코프의 요소가 존재하지 않을 수도 있다.\n모듈이라는 방식을 이용하면 각각 필요한 모듈을 import하여 사용함으로써 어디에서 에러가 나는지 파악하기 쉽다.\nimport, export 하는 시스템을 모듈 시스템이라 하는데 현재 2가지의 모듈 시스템이 활발하게 사용되고 있다.</p>\n<ul>\n<li><strong>CommonJS</strong></li>\n<li><strong>ES modules</strong></li>\n</ul>\n<h3>CommonJS</h3>\n<h4><strong>동기식</strong></h4>\n<ul>\n<li>require가 동기로 이루어지므로 promise를 return 하지 않는다.</li>\n<li>따라서 CommonJS는 실행해보아야 import, export 에러를 감지할 수 있다.</li>\n<li>기본 값이다.</li>\n<li>top-level await가 불가능하다. (<code class=\"language-text\">async function</code> 밖에서 <code class=\"language-text\">await</code>을 사용하게 해주는 것)</li>\n<li>export, import하는 변수가 다르다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> module <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'어쩌구'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> func <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'어쩌구'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token string\">'어쩌구'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// default exports module.exports.func = () => {}; // named exports</span></code></pre></div>\n<h3>ES modules</h3>\n<h4><strong>비동기식</strong></h4>\n<ul>\n<li>모듈을 비동기 환경에서 다운로드하며, import export 구문을 찾아서 파싱한다.</li>\n<li>따라서 ES modules는 실행해보지 않아도 import, export 에러를 감지할 수 있다.</li>\n<li>config를 type=“module” 로 set 해주어야 사용할 수 있다.</li>\n<li>top-level await가 가능하다.(<code class=\"language-text\">async function</code> 밖에서 <code class=\"language-text\">await</code>을 사용하게 해주는 것)</li>\n<li>export와 import를 같은 변수에 실제 값으로 채운다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> a <span class=\"token keyword\">from</span> <span class=\"token string\">'어쩌구'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>func<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'어쩌구'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> a <span class=\"token operator\">=</span> <span class=\"token string\">'어쩌구'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// default exports export default func = () => {}; // named exports</span></code></pre></div>\n<h3>동작 방식</h3>\n<h4>CommonJS</h4>\n<p>(module.exports, exports, require)\n<em><strong>module.exports:</strong></em>\n자바스크립트에서는 변수에 모든 형태의 데이터를 넣을 수 있기 때문에 module.exports도 값으로 허용되는 모든 데이터를 export 할 수 있다</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token constant\">PI</span> <span class=\"token operator\">=</span> <span class=\"token number\">3.14</span><span class=\"token punctuation\">;</span>\nmodule<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">=</span> <span class=\"token constant\">P</span><span class=\"token punctuation\">.</span><span class=\"token constant\">I</span>\n\n<span class=\"token keyword\">const</span> utils <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./utils'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>utils<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">/</span>\n</code></pre></div>\n<p><strong>exports:</strong>\nexports도 module.exports와 같은 동작을 수행\n(실제적으로는 exports는 module.exports의 데이터를 참조하고)</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">exports<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">=</span> <span class=\"token number\">3.14</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">===</span> exports<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>exports<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// { PI: 3.14 }</span></code></pre></div>\n<p><strong>require:</strong>\n다른 모듈 파일을 볼러오는 명령어 상대경로’에 있는 파일 중 확장자가 .js, .json, .node 인 파일을 모듈로 불러올 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span> <span class=\"token string-property property\">\"data\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Hello World!\"</span><span class=\"token punctuation\">}</span>\nmodule<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span>\n\n<span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./data'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> utils <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./utils'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// { data: \"Hello World!\" }</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>utils<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// </span></code></pre></div>\n<ul>\n<li>Node.js는 상대경로(./, ../)나 절대경로(/)로 모듈을 호출하면 다음과 같은 순서로 필요한 파일을 탐색하는데,첫 번째와 두 번째에서 파일 탐색에 실패하면 Cannot find module 에러를 던짐</li>\n<li>Node.js에서 상대경로(./, ../)나 절대경로(/)를 표시하지 않고 require를 호출하면 Node.js는 현재 모듈의 최상위 디렉토리에서 부터 /node_modules 폴더를 탐색</li>\n</ul>\n<h4>ES modules</h4>\n<p>(export, import)\n<strong>export:</strong>\nexport는 기본적으로 named export와 default export의 두 가지 방식과 export와 from을 조합해서 사용하는 방식이있다.</p>\n<h5>named export은</h5>\n<ul>\n<li>선언된 변수명을 그대로 export하는 방식</li>\n<li>변수를 선언함과 동시에 내보내기를 할 수도 있다</li>\n<li>변수들을 모아서 내보내거나, 먼저 정의된 함수를 별칭으로 바꿔서 내보낼 수도 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">let</span> name1<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> name2<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">var</span> name3<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">name4</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token comment\">/*...*/</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyClass</span> <span class=\"token punctuation\">{</span><span class=\"token comment\">/*...*/</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> var1<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> var2<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> var3<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token punctuation\">{</span> var1<span class=\"token punctuation\">,</span> var2<span class=\"token punctuation\">,</span> var3<span class=\"token punctuation\">}</span></code></pre></div>\n<h5>default export은</h5>\n<ul>\n<li>모듈에서 하나만 존재할 수 있다.</li>\n<li>변수를 직접 내보낼 수는 없다.</li>\n<li>export default {const, let, var} 처럼 변수를 직접 내보내는 방식으로 사용하면 에러가 발생</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> expression<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/*...*/</span> <span class=\"token punctuation\">}</span>            <span class=\"token comment\">// 익명함수</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">myFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/*...*/</span> <span class=\"token punctuation\">}</span> <span class=\"token comment\">// 기명함수</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/*...*/</span> <span class=\"token punctuation\">}</span>                  <span class=\"token comment\">// 클래스</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyClass</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/*...*/</span> <span class=\"token punctuation\">}</span>          <span class=\"token comment\">// 커스텀 클래스</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span><span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/*...*/</span> <span class=\"token punctuation\">}</span>           <span class=\"token comment\">// 제너레이터</span>\n<span class=\"token comment\">// named export 처럼 묶어서 내보내기</span>\n<span class=\"token keyword\">const</span> myModule <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/*...*/</span> <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">var1</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<h5>export-from은</h5>\n<ul>\n<li>import와 export를 한 번에 처리할 수 있는 문법</li>\n<li>주로 패키지의 다른 모듈들을 한 번에 모아서 일관된 형태로 내보내거나 관리하고 싶은 경우에 사용</li>\n<li>식별자가 바인딩 되지 않기 때문에 메서드나 변수에 직접 접근하면 에러가 발생\n(에러가 발생하는 이유는 해당 메서드가 스코프내에 존재하지 않기 때문)</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// math 모듈에서 일부만 import 한 뒤 다시 export</span>\n<span class=\"token keyword\">export</span> <span class=\"token punctuation\">{</span> add<span class=\"token punctuation\">,</span> subtract <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./math'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// config 모듈의 (export가 가능한)모든 변수를 export</span>\n<span class=\"token keyword\">export</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./config'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// logger 모듈의 default export를 Logger라는 이름으로 export</span>\n<span class=\"token keyword\">export</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">as</span> Logger <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./logger'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>import:</strong>\nimport는 다른 파일에서 모듈을 불러오는 명령어\nas 명령어를 이용해서 별칭으로 불러오거나, *를 사용해서 named export의 모든 변수와 메서드를 불러올 수도 있다.</p>\n<h3>실제 사용</h3>\n<p>React에서는 ESModules을 주로 사용한다. 패키지 모듈들은 결국 CommonJS를 기본 모듈 시스템으로 선택하기 때문에, 코드 작성 시 CommonJS로 변환해주어야 하는데 해당 작업은 번들러인 Babel이 수행한다.\nVite부터가 브라우저가 ESM Import를 해석할 수 있다는 전제 하에 만들어진 물건\n<a href=\"https://runebook.dev/ko/docs/babel/babel-plugin-transform-modules-commonjs/index\" target=\"_blank\" rel=\"nofollow\">https://runebook.dev/ko/docs/babel/babel-plugin-transform-modules-commonjs/index</a></p>\n<h3>정리</h3>\n<p>모듈 시스템 중 CommonJS가 처음에 등장하였으나, 현재는 ES modules 모듈 시스템이 많이 사용되고 있다. CommonJS와 비교하여 ES modules는 비동기로 동작하여 속도가 빠르고 실제 사용되는 부분만을 import(tree shaking) 하여 메모리를 적게 차지하며 가독성이 좋고 순환 의존성을 지원한다는 이점이 있다.\n%%ESM은 ECMAScript에서 지원하는 자바스크립트 공식 모듈 시스템이지만\n브라우저에 따라서는 아직 import와 export를 지원하지 않는 경우도 있어서 가능하면 webpack과 같은 번들러를 사용하는 것%%</p>\n<p><a href=\"https://nodejs.org/api/packages.html#determining-module-system\" title=\"https://nodejs.org/api/packages.html#determining-module-system\" target=\"_blank\" rel=\"nofollow\">https://nodejs.org/api/packages.html#determining-module-system</a> 여기 보시면 .mjs랑 .cjs 관련 내용이 나오는데\n이 확장자들을 사용하면 “type”: “module” 안에서도 CommonJS를 쓸 수 있고 “type”: “commonjs” 안에서도 ESM을 쓸 수 있다</p>\n<p>이전까지는 ESM 문법을 쓰더라도 Webpack 같은 게 전부 CJS로 변환해버렸을</p>\n<p>➕➕ CJS 패키지에서는 ESM을 못 <code class=\"language-text\">require()</code> 하기 때문에 ESM 패키지에서 CJS 패키지를 사용하는데 CJS 패키지가 읽을 설정 파일 같은 걸 만든다 하면 .cjs 확장자로 만들어야 한다</p>","frontmatter":{"title":"ESM과 CommonJS","summary":"자바스크립트 모듈 시스템: ESM과 CommonJS","date":"2022.03.04.","categories":["ESM","CommonJS","Module"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABdUlEQVQoz42Sy0rDQBSG+2y+gm8guHfpxoWgoLh2507E4koEN4ouLOpCFMRr1VaNtZqkbXrJZZJJ5pOJplRNxAOHyVzyzX/+MyUApRTZmPxIHV1f8toVPLcD7EFEwxEYnYBXRxDKhFFGia/IFvLCj2Lqts/Nu5fCXjoBjicJooQ4Ub+B2UQrenEEd5ZH1fSot3weWwHWIPzzwtG9b8C+kCmo48m0JK1Gq7hsuly/uZj9EJmooTXqKwsVumHMremlPz+1g+GtGqTnBw9dwjj5v0LtR6MrODX6XL253Js+qxWTtUOT8rHN7oXzaU2i0moGIh42rrApQiY0eyE7t23KJxbzmwaLWwYz5Ror+02MjuCo3uPB8ukFMj1fWHI2ap90Z8+NAUvbDaaWzxib3GRho4rlybT8lhvhhTFRXAAchWbfVj9idqPGxFyF8ek9ltavcr375WHRgShW1E2f43uHStXB7oXkCcj1sKhzCoXtRmn+BOQ9mw+Emk8N71JAVQAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/bde0b4545912d99e1ac9bde350cde4c2/ee05c/module.png","srcSet":"/static/bde0b4545912d99e1ac9bde350cde4c2/37ce8/module.png 853w,\n/static/bde0b4545912d99e1ac9bde350cde4c2/7f74d/module.png 1706w,\n/static/bde0b4545912d99e1ac9bde350cde4c2/ee05c/module.png 3411w","sizes":"(min-width: 3411px) 3411px, 100vw"},"sources":[{"srcSet":"/static/bde0b4545912d99e1ac9bde350cde4c2/f8207/module.webp 853w,\n/static/bde0b4545912d99e1ac9bde350cde4c2/b5a6b/module.webp 1706w,\n/static/bde0b4545912d99e1ac9bde350cde4c2/ce9d6/module.webp 3411w","type":"image/webp","sizes":"(min-width: 3411px) 3411px, 100vw"}]},"width":3411,"height":1835}},"publicURL":"/static/bde0b4545912d99e1ac9bde350cde4c2/module.png"}}}}]}},"pageContext":{"slug":"/Modules/JS_Modules/"}},"staticQueryHashes":[]}